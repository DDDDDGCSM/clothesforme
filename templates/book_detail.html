<!DOCTYPE html>
<html lang="es-MX">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ book.title }} - Trueque Digital</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header>
        <nav>
            <div class="logo">Trueque Digital</div>
            <ul class="nav-links">
                <li><a href="/">Plaza de Libros</a></li>
                <li><a href="/exchange-wall">El Mural del Trueque</a></li>
                <li><a href="#mi-estanteria">Mi Estanter√≠a</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="book-detail-container">
            <!-- Ê†áÁ≠æÈ°µÂØºËà™ -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="book">El Libro</button>
                <button class="tab-btn" data-tab="story">Su Historia</button>
                <button class="tab-btn" data-tab="exchanges">Intercambios Pasados</button>
            </div>

            <!-- Ê†áÁ≠æÈ°µÂÜÖÂÆπ -->
            <div class="tab-content active" id="tab-book">
                <h2>{{ book.title }}</h2>
                <p class="author">por {{ book.author }}</p>

                <!-- Áõ∏ÂÜå -->
                <div class="photo-gallery">
                    <div class="photo-item">
                        <img src="{{ book.cover }}" alt="Portada">
                    </div>
                    <div class="photo-item">
                        <img src="{{ book.cover }}" alt="P√°gina de t√≠tulo">
                    </div>
                    <div class="photo-item">
                        <img src="{{ book.cover }}" alt="Anotaciones">
                    </div>
                </div>

                <!-- ËØ¶ÁªÜ‰ø°ÊÅØ -->
                <div style="margin-top: 30px;">
                    <h3>Informaci√≥n del Libro</h3>
                    <div style="background: var(--color-paper-light); padding: 20px; border-radius: 8px; margin-top: 15px;">
                        <p><strong>ISBN:</strong> {{ book.isbn }}</p>
                        <p><strong>Editorial:</strong> {{ book.publisher }}</p>
                        <p><strong>Estado:</strong> {{ book.condition }}</p>
                    </div>
                </div>

                <!-- ‰π¶Á±çÊóÖÁ®ã -->
                <div style="margin-top: 40px;">
                    <h3>El viaje de este libro</h3>
                    <div class="timeline">
                        {% for exchange in exchange_history %}
                        <div class="timeline-item">
                            <div class="timeline-date">{{ exchange.date }}</div>
                            <div class="timeline-content">
                                <p><strong>{{ exchange.from_user }}</strong> ‚Üí <strong>{{ exchange.to_user }}</strong></p>
                                <p style="color: var(--color-text-light); font-size: 14px;">{{ exchange.city }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Ê†áÁ≠æÈ°µ2: Su Historia -->
            <div class="tab-content" id="tab-story">
                <!-- ÂèëËµ∑‰∫∫‰ø°ÊÅØ -->
                <div style="text-align: center; margin-bottom: 40px;">
                    <img src="{{ book.user.avatar }}" alt="{{ book.user.name }}" 
                         style="width: 120px; height: 120px; border-radius: 50%; margin-bottom: 15px;">
                    <h2>{{ book.user.name }}</h2>
                    <span class="trust-badge {{ book.user.trust_level }}">{{ book.user.trust_badge }}</span>
                    <p style="margin-top: 15px;">
                        <a href="#" style="color: var(--color-primary); text-decoration: none;">
                            Ver Mi Estanter√≠a ‚Üí
                        </a>
                    </p>
                </div>

                <!-- ÊïÖ‰∫ãÊ≠£Êñá -->
                <div style="background: var(--color-paper-light); padding: 30px; border-radius: 10px;">
                    <h3 style="margin-bottom: 20px; color: var(--color-primary);">Mi historia con este libro</h3>
                    <div style="line-height: 1.8; color: var(--color-text);">
                        <p>Este libro lleg√≥ a mis manos en un momento muy especial de mi vida. {{ book.why_release }}</p>
                        <p style="margin-top: 20px;">Lo le√≠ durante las tardes de verano, sentada en el jard√≠n de mi abuela. Cada p√°gina me transportaba a Macondo, un lugar que sent√≠a tan real como mi propio barrio.</p>
                        <p style="margin-top: 20px;">Ahora, despu√©s de varios a√±os, siento que es momento de dejarlo ir. Quiero que encuentre a alguien que tambi√©n necesite esta historia, que busque respuestas o simplemente quiera perderse en sus p√°ginas.</p>
                        <p style="margin-top: 20px; font-style: italic; color: var(--color-text-light);">
                            Si este libro te llama, si sientes que puede ser para ti, entonces probablemente lo sea. Elige un libro de tu estanter√≠a que sea una respuesta digna a esta historia, y empecemos un di√°logo.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Ê†áÁ≠æÈ°µ3: Intercambios Pasados -->
            <div class="tab-content" id="tab-exchanges">
                <h3>Intercambios Realizados</h3>
                <div style="margin-top: 30px;">
                    {% for exchange in exchange_history %}
                    <div class="exchange-card" style="margin-bottom: 20px;">
                        <div class="exchange-books">
                            <div class="exchange-book">
                                <img src="{{ book.cover }}" alt="Libro intercambiado">
                                <p style="margin-top: 10px; font-weight: 600;">{{ exchange.from_user }}</p>
                            </div>
                            <div class="exchange-icon">ü§ù</div>
                            <div class="exchange-book">
                                <img src="{{ book.cover }}" alt="Libro recibido">
                                <p style="margin-top: 10px; font-weight: 600;">{{ exchange.to_user }}</p>
                            </div>
                        </div>
                        <div class="exchange-message">
                            "Un intercambio maravilloso. El libro lleg√≥ en perfecto estado y la historia que comparti√≥ fue conmovedora."
                        </div>
                        <div class="exchange-date">{{ exchange.date }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- ‰æßËæπÊ†èË°åÂä®Âå∫ -->
            <div class="sidebar-action">
                <h3 style="margin-bottom: 10px;">¬øTe llama este libro?</h3>
                <p style="font-size: 14px; opacity: 0.9;">Inicia un di√°logo a trav√©s de los libros</p>
                <button class="exchange-btn" onclick="openExchangeModal()">
                    üìñ Solicitar Intercambio
                </button>
                <p style="font-size: 12px; margin-top: 15px; opacity: 0.8;">
                    Requisitos: Perfil completo y al menos 1 libro en tu estanter√≠a
                </p>
            </div>
        </div>
    </div>

    <!-- Áî≥ËØ∑‰∫§Êç¢Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="exchangeModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeExchangeModal()">&times;</button>
            
            <!-- Paso 1: Cu√©ntale tu historia -->
            <div class="modal-step active" id="step1">
                <div class="step-indicator">
                    <div class="step active">
                        <span>1</span>
                        <div class="step-content">Tu Historia</div>
                    </div>
                    <div class="step">
                        <span>2</span>
                        <div class="step-content">Elige tu Libro</div>
                    </div>
                </div>

                <h2 style="margin-bottom: 20px;">Cu√©ntale tu historia</h2>
                <p style="color: var(--color-text-light); margin-bottom: 25px;">
                    ¬øPor qu√© este libro te llama a ti? ¬øCon qu√© libro tuyo quieres responder a su historia?
                </p>
                
                <div class="form-group">
                    <label>Tu historia (m√≠nimo 50 palabras)</label>
                    <textarea id="userStory" placeholder="Escribe aqu√≠ por qu√© este libro te llama y qu√© libro de tu estanter√≠a quieres intercambiar..."></textarea>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeExchangeModal()">Cancelar</button>
                    <button class="btn btn-primary" onclick="nextStep(2)">Siguiente</button>
                </div>
            </div>

            <!-- Paso 2: Elige tu libro -->
            <div class="modal-step" id="step2">
                <div class="step-indicator">
                    <div class="step completed">
                        <span>‚úì</span>
                        <div class="step-content">Tu Historia</div>
                    </div>
                    <div class="step active">
                        <span>2</span>
                        <div class="step-content">Elige tu Libro</div>
                    </div>
                </div>

                <h2 style="margin-bottom: 20px;">Elige tu libro</h2>
                <p style="color: var(--color-text-light); margin-bottom: 25px;">
                    Un trueque es un di√°logo. Elige un libro que sea una respuesta digna.
                </p>

                <div class="book-selector" id="bookSelector">
                    <!-- Á§∫‰æãÂõæ‰π¶ÈÄâÈ°π -->
                    <div class="book-option" onclick="selectBook(this)">
                        <img src="https://images-na.ssl-images-amazon.com/images/I/71QKQ9KJZJL.jpg" alt="Libro">
                        <p style="margin-top: 10px; font-size: 14px;">La casa de los esp√≠ritus</p>
                    </div>
                    <div class="book-option" onclick="selectBook(this)">
                        <img src="https://images-na.ssl-images-amazon.com/images/I/81Y5Z8KJZJL.jpg" alt="Libro">
                        <p style="margin-top: 10px; font-size: 14px;">Rayuela</p>
                    </div>
                    <div class="book-option" onclick="selectBook(this)">
                        <img src="https://images-na.ssl-images-amazon.com/images/I/81dQwQlmAXL.jpg" alt="Libro">
                        <p style="margin-top: 10px; font-size: 14px;">Cien a√±os de soledad</p>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="prevStep(1)">Atr√°s</button>
                    <button class="btn btn-primary" onclick="submitExchange()">Enviar Solicitud</button>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/book_detail.js') }}"></script>
</body>
</html>

